(this.webpackJsonpvjam=this.webpackJsonpvjam||[]).push([[0],{146:function(e){e.exports=JSON.parse('{"name":"vjam","version":"0.2.3","homepage":"https://thomasgeissl.github.io/vjam/","private":true,"dependencies":{"@material-ui/core":"^4.9.11","@material-ui/icons":"^4.9.1","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.3.2","@testing-library/user-event":"^7.1.2","gh-pages":"^2.2.0","mqtt":"^3.0.0","react":"^16.13.1","react-dom":"^16.13.1","react-redux":"^7.2.0","react-router-dom":"^5.1.2","react-scripts":"3.4.1","react-use-gesture":"^7.0.15","redux":"^4.0.5","redux-observable":"^1.2.0","styled-components":"^5.0.1","tone":"^13.8.25"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"#react-scripts test","eject":"react-scripts eject","deploy":"yarn build && gh-pages -d build","travisdeploy":"CI=false yarn build && gh-pages -d build -r https://$GH_TOKEN@github.com/thomasgeissl/vjam.git","localTest":"yarn build && mkdir vjam && mv build/* vjam && mv vjam build && http-serve build"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},153:function(e,t,n){e.exports=n.p+"static/media/bird.71112820.wav"},154:function(e,t,n){e.exports=n.p+"static/media/waterbird.6bb42376.wav"},155:function(e,t,n){e.exports=n.p+"static/media/bonecrack.c37d9ccf.wav"},156:function(e,t,n){e.exports=n.p+"static/media/footsteps.3497fc94.wav"},157:function(e,t,n){e.exports=n.p+"static/media/windandchimes.4a6e1b51.wav"},158:function(e,t,n){e.exports=n.p+"static/media/toolfalling.394aa099.wav"},159:function(e,t,n){e.exports=n.p+"static/media/cat.ce192f93.wav"},160:function(e,t,n){e.exports=n.p+"static/media/fireworks.23af77c2.wav"},161:function(e,t,n){e.exports=n.p+"static/media/Roland-GR-1-Steel-Drum-C4.777ed87c.wav"},175:function(e,t,n){e.exports=n(283)},180:function(e,t,n){},188:function(e,t){},190:function(e,t){},275:function(e,t){},276:function(e,t){},283:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(9),i=n.n(c),u=(n(180),n(10)),o=n(7),s=n(84),l=n(46),f=n(11),m=n(21),p=n(317),v=n(326),d=n(12),b=n.n(d);function y(){var e=Object(u.a)(["\n  margin-top: 92px;\n  text-align: center;\n"]);return y=function(){return e},e}function g(){var e=Object(u.a)(["\n  p {\n    margin-top: 24px;\n    margin-bottom: 24px;\n  }\n"]);return g=function(){return e},e}function E(){var e=Object(u.a)([""]);return E=function(){return e},e}function h(){var e=Object(u.a)(["\n  position: fixed;\n  padding: 25px;\n  top: 0;\n  right: 0%;\n"]);return h=function(){return e},e}function O(){var e=Object(u.a)(["\n  max-width: 768px;\n  margin: auto;\n  margin-top: 100px;\n"]);return O=function(){return e},e}var j=n(146).version,x=f.a.div(O()),w=f.a.div(h()),S=f.a.section(E()),k=f.a.section(g()),T=f.a.div(y()),R=function(){var e=Object(a.useState)(function(e){for(var t="",n="abcdefghijklmnopqrstuvwxyz0123456789",a=n.length,r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*a));return t}(4)),t=Object(m.a)(e,2),n=t[0],c=t[1],i=Object(l.f)();return r.a.createElement(x,null,r.a.createElement(w,null,j),r.a.createElement(S,null,"Welcome to vjam,",r.a.createElement("br",null),"a virtual jam session for everyone."),r.a.createElement(k,null,r.a.createElement("p",null,"Please enter a valid room id provided by your jam session partners. You can also open a new one by using any random id, which is hopefully not yet taken - good luck."),r.a.createElement(T,null,r.a.createElement(v.a,{value:n,onChange:function(e){return c(e.target.value)}}),r.a.createElement(p.a,{onClick:function(){"running"!==b.a.context.state&&b.a.context.resume(),i.push("rooms/".concat(n))}},"enter"))))},C=n(325),N=n(318),D=n(152),M=n(151),A=n.n(M).a.connect("wss://try:try@broker.shiftr.io"),P=n(23),J="TRIGGERATTACK",F="TRIGGERRELEASE",B="SETUSER",H={JUNO:"JUNO",RHODES:"RHODES",MPC:"MPC",STEELDRUM:"STEELDRUM"},I={instruments:{JUNO:{user:"",note:null,velocity:0},RHODES:{user:"",note:null,velocity:0},MPC:{user:"",note:null,velocity:0},STEELDRUM:{user:"",note:null,velocity:0}}},U=function(e){return function(t){return t.band.instruments[e].note}},G=function(e){return function(t){return t.band.instruments[e].velocity}},W=function(e){return function(t){return t.band.instruments[e].user}},_=function(e,t,n){return{type:J,payload:{instrument:e,note:t,velocity:n}}},L=function(e){var t=[];return Object.keys(e.band.instruments).forEach((function(n){t.push(e.band.instruments[n].user)})),t};function K(){var e=Object(u.a)(["\n  width: 100%;\n  height: 100%;\n  background-color: lightskyblue;\n"]);return K=function(){return e},e}var X=f.a.div(K()),q=["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4"],Y=function(e){var t=e.active,n=e.type,c=e.prefix,i=function(e){var t=e.event;if(t.touches){var n=t.touches[0],a=t.srcElement;if(n&&a)return{x:(n.clientX-a.getBoundingClientRect().left)/a.offsetWidth,y:1-(n.clientY-a.getBoundingClientRect().top)/a.offsetHeight}}else{var r=t.srcElement;if(r)return{x:(t.clientX-r.getBoundingClientRect().left)/r.offsetWidth,y:1-(t.clientY-r.getBoundingClientRect().top)/r.offsetHeight}}},u=Object(a.useRef)(null),o=Object(D.a)({onDrag:function(e){if(t){e.event.preventDefault();var a=i(e);if(a){var r=q[Math.floor(a.x*q.length)];A.publish(c,JSON.stringify(_(n,r,a.y)))}}},onDragStart:function(e){if(t){e.event.preventDefault();var a=i(e);if(a){var r=q[Math.floor(a.x*q.length)];A.publish(c,JSON.stringify(_(n,r,a.y)))}}},onDragEnd:function(e){t&&(e.event.preventDefault(),A.publish(c,JSON.stringify({type:F,payload:{instrument:n}})))}},{domTarget:u,eventOptions:{passive:!1}});return r.a.useEffect(o,[o]),r.a.createElement(X,{ref:u})};function $(){var e=Object(u.a)(["\n  width: 100%;\n  background-color: lightyellow;\n"]);return $=function(){return e},e}function z(){var e=Object(u.a)(["\n  height: 200px;\n  width: 100%;\n  ","\n"]);return z=function(){return e},e}var V=f.a.div(z(),(function(e){return e.active&&"\n    border: solid darkgreen 3px;\n  "})),Q=f.a.div($()),Z=function(e){var t=e.type,n=e.user,a=e.children,c=e.inputPad,i=e.prefix,u=Object(o.c)((function(e){return e.system.name})),s=Object(o.c)((function(e){return e.system.users})),l=Object(o.c)((function(e){return e.band.instruments}))[t];return r.a.createElement(C.a,{clone:!0,order:l.user===u?1:t.length},r.a.createElement(N.a,{item:!0,xs:12,sm:3},r.a.createElement(Q,null,t,": ",s.includes(n)?n:""),r.a.createElement(V,{active:u===l.user},c&&r.a.createElement(Y,{type:t,active:n===u,prefix:i}),a)))},ee=function(e){var t=e.type,n=e.prefix,c=Object(a.useState)(null),i=Object(m.a)(c,2),u=i[0],s=i[1],l=Object(o.c)(U(t)),f=Object(o.c)(G(t)),p=Object(o.c)(W(t));return Object(a.useEffect)((function(){var e=new d.Synth({oscillator:{type:"sine"},envelope:{attack:.05,decay:.1,sustain:.3,release:1}}),t=new d.Freeverb(.4,1e3),n=new d.PingPongDelay({delayTime:"8n",feedback:.4,wet:.5});e.connect(d.Master),n.connect(t),t.connect(d.Master),s(e)}),[]),Object(a.useEffect)((function(){u&&(l?u.triggerAttack(l,void 0,f):u.triggerRelease())}),[u,l,f]),r.a.createElement(Z,{type:t,user:p,inputPad:!0,prefix:n})},te=function(e){var t=e.type,n=e.prefix,c=Object(a.useState)(null),i=Object(m.a)(c,2),u=i[0],s=i[1],l=Object(o.c)(U(t)),f=Object(o.c)(G(t)),p=Object(o.c)(W(t));return Object(a.useEffect)((function(){var e=new d.Synth({frequency:200,envelope:{attack:.001,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5}),t=new d.Freeverb(.4,1e3),n=new d.PingPongDelay({delayTime:"8n",feedback:.4,wet:.5});e.connect(d.Master),n.connect(t),t.connect(d.Master),s(e)}),[]),Object(a.useEffect)((function(){u&&(l?u.triggerAttack(l,void 0,f):u.triggerRelease())}),[u,l,f]),r.a.createElement(Z,{type:t,user:p,inputPad:!0,prefix:n})};function ne(){var e=Object(u.a)(["\n  width: 100%;\n  height: 100px;\n  div {\n    width: 100%;\n    height: 100px;\n    background-color: lightgreen;\n    border: 1px solid black;\n  }\n"]);return ne=function(){return e},e}var ae=Object(f.a)(N.a)(ne()),re=function(e){var t=e.clickHandler;return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae,{item:!0,xs:3,onClick:t},r.a.createElement("div",null)))},ce=function(e){var t=e.type,n=e.triggers,a=e.prefix,c=e.active;return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{container:!0,spacing:1},n.map((function(e,n){return r.a.createElement(re,{key:n,clickHandler:function(){c&&A.publish(a,JSON.stringify(_(t,e.pitch,Math.random())))}})}))))},ie=n(153),ue=n.n(ie),oe=n(154),se=n.n(oe),le=n(155),fe=n.n(le),me=n(156),pe=n.n(me),ve=n(157),de=n.n(ve),be=n(158),ye=n.n(be),ge=n(159),Ee=n.n(ge),he=n(160),Oe=n.n(he),je=function(e){var t=e.type,n=e.prefix,c=Object(a.useState)(null),i=Object(m.a)(c,2),u=i[0],s=i[1],l=Object(o.c)(U(t)),f=Object(o.c)(G(t)),p=Object(o.c)(W(t)),v=(Object(o.c)((function(e){return e.band.instruments})),Object(o.c)((function(e){return e.system.name})));return Object(a.useEffect)((function(){var e=new d.Sampler({C2:ue.a,F2:se.a,C3:fe.a,F3:pe.a,C4:de.a,F4:ye.a,C5:Ee.a,F5:Oe.a});e.volume.value=-6;var t=new d.Freeverb(.6,3e3),n=new d.PingPongDelay({delayTime:"32n",feedback:.7,wet:.25});e.connect(n),n.connect(t),t.connect(d.Master),s(e)}),[]),Object(a.useEffect)((function(){u&&(l?u.triggerAttackRelease(l,2e3):u.triggerRelease())}),[u,l,f]),r.a.createElement(Z,{type:t,user:p,inputPad:!1,prefix:n},r.a.createElement(ce,{active:p===v,triggers:[{pitch:"C2"},{pitch:"F2"},{pitch:"C3"},{pitch:"F3"},{pitch:"C4"},{pitch:"F4"},{pitch:"C5"},{pitch:"F5"}],type:t,prefix:n}))},xe=function(e){var t=e.prefix,n=e.type,c=e.samples,i=Object(a.useState)(null),u=Object(m.a)(i,2),s=u[0],l=u[1],f=Object(o.c)(U(n)),p=Object(o.c)(G(n)),v=Object(o.c)(W(n));return Object(a.useEffect)((function(){var e=new d.Sampler(c);e.volume.value=-6;var t=new d.Freeverb(.6,5e3),n=new d.PingPongDelay({delayTime:"32n",feedback:.7,wet:.25});e.volume.value=-24,e.connect(n),n.connect(t),t.connect(d.Master),l(e)}),[c]),Object(a.useEffect)((function(){s&&(f?s.triggerAttack(f,void 0,p):s.triggerRelease())}),[s,f,p]),r.a.createElement(Z,{type:n,user:v,inputPad:!0,prefix:t})},we=n(78),Se="ADDUSER",ke="SETUSERS",Te="SETNAME",Re="HEARTBEAT",Ce={name:"",users:[],heartBeats:new Map};function Ne(){var e=Object(u.a)(["\n  background-color: lightpink;\n  padding: 10px;\n  list-style-type: none;\n  li {\n    display: inline-block;\n    margin-right: 15px;\n  }\n"]);return Ne=function(){return e},e}var De=f.a.ul(Ne()),Me=function(e){var t=e.prefix,n=Object(o.c)((function(e){return e.system.users})),c=Object(o.c)((function(e){return e.system.name}));Object(o.c)(L);return Object(a.useEffect)((function(){setInterval((function(){A.publish(t,JSON.stringify({type:Re,payload:{value:c}}))}),1e3)}),[t,c]),r.a.createElement(De,null,n.map((function(e,t){return r.a.createElement("li",{key:t},e!==c&&r.a.createElement("span",null,e),e===c&&r.a.createElement("b",null,e))})))},Ae="ADDMESSAGE",Pe={messages:[]};function Je(){var e=Object(u.a)(["\n  font-weight: bold;\n"]);return Je=function(){return e},e}function Fe(){var e=Object(u.a)(["\n  height: 50px;\n  overflow-y: scroll;\n"]);return Fe=function(){return e},e}function Be(){var e=Object(u.a)(["\n  background-color: lightcoral;\n  padding: 10px;\n"]);return Be=function(){return e},e}var He=f.a.div(Be()),Ie=f.a.ul(Fe()),Ue=f.a.span(Je()),Ge=function(e){var t=e.prefix,n=Object(a.useState)(""),c=Object(m.a)(n,2),i=c[0],u=c[1],s=Object(o.c)((function(e){return e.chat.messages})),l=Object(o.c)((function(e){return e.system.name}));return r.a.createElement(He,null,r.a.createElement(v.a,{fullWidth:!0,value:i,placeholder:"something nice you wanna say to your friends",onChange:function(e){return u(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(A.publish(t,JSON.stringify(function(e,t){return{type:Ae,payload:{message:{sender:e,text:t}}}}(l,i))),u(""))}}),r.a.createElement(Ie,null,s.map((function(e,t){return r.a.createElement("li",{key:t},r.a.createElement(Ue,null,e.sender)," > ",e.text)}))))},We=n(316),_e=n(327),Le=n(322),Ke=n(328);function Xe(){var e=Object(u.a)(["\n  width: 100%;\n  margin-top: 25px;\n  margin-bottom: 25px;\n"]);return Xe=function(){return e},e}var qe=f.a.div(Xe()),Ye=function(e){var t,n=e.prefix,a=Object(o.c)((function(e){return e.system.name})),c=Object(o.c)((function(e){return e.band.instruments})),i=Object(o.c)((t=a,function(e){var n="NONE";return Object.keys(e.band.instruments).forEach((function(a){e.band.instruments[a].user===t&&(n=a)})),n}));return r.a.createElement(qe,null,r.a.createElement(N.a,{container:!0},r.a.createElement(N.a,{item:!0,xs:4},r.a.createElement(We.a,{fullWidth:!0},r.a.createElement(_e.a,null,"Pick an instrument"),r.a.createElement(Le.a,{value:i,onChange:function(e){Object.keys(c).forEach((function(e){""!==c[e].user&&!0})),A.publish(n,JSON.stringify(function(e,t){return{type:B,payload:{instrument:e,user:t}}}(e.target.value,a)))},fullWidth:!0},r.a.createElement(Ke.a,{value:"NONE"},"none"),";",Object.keys(H).map((function(e,t){return r.a.createElement(Ke.a,{value:H[e],key:t},H[e])})))))))},$e=n(44),ze=n(323),Ve=Object($e.c)({system:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ce,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Re:var n=new Map(e.heartBeats),a=Object(we.a)(e.users);return n.set(t.payload.value,Date.now()),n.forEach((function(e,t){if(Date.now()>e+1e4){n.delete(t);var r=a.indexOf(t);-1!==r&&a.splice(r,1)}})),Object(P.a)({},e,{heartBeats:n,users:a});case ke:return Object(P.a)({},e,{users:t.payload.value});case Se:var r=Object(we.a)(e.users);return r.includes(t.payload.value)||r.push(t.payload.value),Object(P.a)({},e,{users:r});case Te:return e.users.includes(t.payload.value)?e:Object(P.a)({},e,{name:t.payload.value});default:return e}},band:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case J:var n=Object(P.a)({},e);return n.instruments[t.payload.instrument].note=t.payload.note,n.instruments[t.payload.instrument].velocity=t.payload.velocity,Object(P.a)({},n);case F:var a=Object(P.a)({},e);return a.instruments[t.payload.instrument].note=null,a.instruments[t.payload.instrument].velocity=0,Object(P.a)({},a);case B:var r=Object(P.a)({},e);return Object.keys(r.instruments).forEach((function(e){r.instruments[e].user===t.payload.user&&(r.instruments[e].user="")})),"NONE"!==t.payload.instrument&&(r.instruments[t.payload.instrument].user=t.payload.user),Object(P.a)({},r);default:return e}},chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ae:var n=Object(we.a)(e.messages);return n.unshift(t.payload.message),n=n.splice(0,100),Object(P.a)({},e,{messages:n});default:return e}}}),Qe=n(319),Ze=n(320),et=n(95),tt=n(321),nt=n(329),at=Object(ze.a)(),rt=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||$e.d,ct=Object($e.e)((function(e,t){return"RESET"===t.type?Ve(void 0,t):"SETSTATE"===t.type?Ve(t.payload,{type:"IGNORE"}):Ve(e,t)}),rt(Object($e.a)(at)));at.run((function(e){return e.pipe(Object(Qe.a)((function(e){return"STARTHEARTBEAT"===e.type})),Object(Ze.a)((function(t){return Object(nt.a)(3e4).pipe(Object(et.a)((function(e){return{type:"HEARTBEAT",payload:{value:1}}})),Object(tt.a)(e.ofType("STOPHEARTBEAT")))})))})),ct.dispatch({type:"INIT"});var it=ct,ut=n(161);function ot(){var e=Object(u.a)(["\n  margin-top: 128px;\n"]);return ot=function(){return e},e}var st={C4:n.n(ut).a},lt=f.a.div(ot()),ft=function(){var e=Object(l.g)().id,t=Object(a.useState)(""),n=Object(m.a)(t,2),c=n[0],i=n[1],u=Object(o.c)((function(e){return e.system.name})),s=Object(o.b)();return Object(a.useEffect)((function(){A.subscribe("vjam/".concat(e),(function(t){t||console.log("subscribed to vjam/".concat(e))})),A.subscribe("vjam/".concat(e,"/users/#"),(function(t){t||console.log("subscribed to vjam/".concat(e,"/users/#"))})),A.on("message",(function(t,n){var a;if(t==="vjam/".concat(e))try{a=JSON.parse(n.toString()),it.dispatch(a)}catch(c){}t==="vjam/".concat(e,"/users/get")&&(JSON.parse(n.toString()).id!==A.options.clientId&&A.publish("vjam/".concat(e,"/users/set"),JSON.stringify(it.getState().system.users)));if(t==="vjam/".concat(e,"/users/set")){var r=JSON.parse(n.toString());it.dispatch({type:ke,payload:{value:r}})}})),A.publish("vjam/".concat(e,"/users/get"),JSON.stringify({id:A.options.clientId}))}),[e]),r.a.createElement(r.a.Fragment,null,""===u&&r.a.createElement(lt,null,r.a.createElement(N.a,{container:!0},r.a.createElement(N.a,{item:!0,xs:2,sm:3}),r.a.createElement(N.a,{item:!0,xs:8,sm:6},"Please let the others know your name. If it is not yet taken, then you will automatically enter the jam session. Submit by pressing return."),r.a.createElement(N.a,{item:!0,xs:2,sm:3}),r.a.createElement(N.a,{item:!0,xs:2,sm:3}),r.a.createElement(N.a,{item:!0,xs:8,sm:6},r.a.createElement(v.a,{fullWidth:!0,value:c,onChange:function(e){i(e.target.value)},onKeyPress:function(t){"Enter"===t.key&&(A.publish("vjam/".concat(e),JSON.stringify({type:Se,payload:{value:c}})),s(function(e){return{type:Te,payload:{value:e}}}(c)))}})))),""!==u&&r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{container:!0},r.a.createElement(N.a,{item:!0,xs:12},r.a.createElement(Me,{prefix:"vjam/".concat(e)})),r.a.createElement(N.a,{item:!0,xs:12},r.a.createElement(Ge,{prefix:"vjam/".concat(e)}))),r.a.createElement(Ye,{prefix:"vjam/".concat(e)}),r.a.createElement(N.a,{container:!0,spacing:3,justify:"flex-start"},r.a.createElement(ee,{type:H.JUNO,prefix:"vjam/".concat(e)}),r.a.createElement(te,{type:H.RHODES,prefix:"vjam/".concat(e)}),r.a.createElement(je,{type:H.MPC,prefix:"vjam/".concat(e)}),r.a.createElement(xe,{type:H.STEELDRUM,samples:st,prefix:"vjam/".concat(e)}))))};function mt(){var e=Object(u.a)(["\n  margin-left: 15px;\n  margin-right: 15px;\n"]);return mt=function(){return e},e}var pt=f.a.div(mt());var vt=function(){return r.a.createElement(pt,null,r.a.createElement(o.a,{store:it},r.a.createElement(s.a,null,r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/rooms/:id"},r.a.createElement(ft,null)),r.a.createElement(l.a,{path:"/"},r.a.createElement(R,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(vt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[175,1,2]]]);
//# sourceMappingURL=main.ade951a0.chunk.js.map